# Gemini開発ノウハウ

このドキュメントは、Geminiとの対話を通じて実装およびデバッグを行う過程で得られた技術的な知見やノウハウを記録します。

## 開発環境とワークフロー

本プロジェクトでは、Pythonのパッケージ管理と仮想環境ツールとして`uv`を使用しています。また、定型タスクは`Taskfile.yml`に定義されています。

### ライブラリ管理
- **ライブラリの追加**:
  ```bash
  uv add <ライブラリ名>
  ```

### スクリプトの実行
- **メインスクリプトの実行**:
  ```bash
  uv run src/main.py
  ```

### 定型タスクの実行
`Taskfile.yml`で定義されたタスクは `uv run task <タスク名>` で実行できます。

- **ユニットテストの実行**:
  ```bash
  uv run task test
  ```
- **コードのフォーマット**:
  ```bash
  uv run task format
  ```
- **Lint（静的解析）の修正**:
  ```bash
  uv run task lint-fix
  ```
- **フォーマットとLintのチェック**:
  ```bash
  uv run task check
  ```
  ※ このコマンドは修正に時間がかかる場合があるため、Geminiに指示されたタイミングで実施してください。

## Pythonスクリプトの実行とモジュール解決

### 問題
プロジェクトのルートディレクトリ外（例: `utils/`）にあるスクリプトから、`src/`ディレクトリ内のモジュールをインポートしようとすると`ModuleNotFoundError`が発生する。

- `utils/script.py` 内の `from src.components.my_module import ...` が失敗する。
- `src`内のモジュール間での相対インポート（例: `from journal_core import ...`）も、実行コンテキストによっては失敗する。

### 解決策
コード自体を修正するのではなく、スクリプトの**実行環境**を調整することで、インポートパスの競合を解決します。`PYTHONPATH`環境変数に、プロジェクトルート (`.`) と `src` ディレクトリの両方をコロン(`:`)で区切って設定します。

```bash
PYTHONPATH=.:src uv run path/to/your/script.py
```

- **`PYTHONPATH=.`**: `from src. ...` という形式のインポートを解決できるようにします。
- **`PYTHONPATH=src`**: `src`ディレクトリ内のモジュールが `from journal_core ...` のように、`src`をルートとして相互にインポートできるようにします。

この方法により、異なる実行コンテキストでも動作する、より堅牢な実行が可能になります。


## Gitコミットのベストプラクティス

### 基本フロー
1.  **変更内容の確認**: `git status`で変更・追加されたファイルの一覧を確認し、`git diff HEAD`で具体的な変更内容を精査します。
2.  **ステージング**: `git add <file1> <file2> ...` でコミット対象のファイルを選択します。一時ファイル（例: コミットメッセージの下書きファイル）はステージングしません。
3.  **整形とテストの実行**: コミット前に、コードの品質を保証するために以下のコマンドを実行します。
    ```bash
    # コードのフォーマットとLint修正
    uv run task format
    uv run task lint-fix

    # ユニットテストの実行と確認
    uv run task test
    ```
    すべてのテストがパスし、整形が完了していることを確認してください。
4.  **ログスタイルの確認**: `git log -n 5`などで過去のコミットメッセージを閲覧し、件名や本文の書き方、言語、粒度などのスタイルを把握・踏襲します。
5.  **コミットメッセージの作成**:
    - **件名(Subject)**: 変更内容の要約を英語の命令形で記述します。（例: `feat: Add image processing feature`）
    - **本文(Body)**:
        - **Why**: なぜこの変更が必要だったのか（目的、背景、修正したバグなど）。
        - **What**: 何を変更したのか（新機能の概要、主要な修正点など）。
        - これらを明確に記述します。
6.  **コミットの実行**: `git commit -m "..."` または、詳細なメッセージの場合は `-F <file>` を使ってコミットします。
